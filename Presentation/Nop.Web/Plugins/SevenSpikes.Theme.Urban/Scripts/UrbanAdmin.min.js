/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

var mapWrapperId = "chooseLocationMap", map, markers = [], latitudeElement, longitudeElement; $(document).ready(function () { $("#urban-settings-edit li[data-maplocation]").one("click", function () { null != document.getElementById(mapWrapperId) && loadMapScript() }); latitudeElement = $("#Latitude"); longitudeElement = $("#Longitude"); $(latitudeElement).on("change", moveMarkerOnCoordinatesChange); $(longitudeElement).on("change", moveMarkerOnCoordinatesChange) }); function loadMapScript() { var a = document.createElement("script"); a.src = "https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&sensor=false&callback=initializeMap"; document.body.appendChild(a) } function initializeMap() { var a = document.getElementById(mapWrapperId), b = { center: new google.maps.LatLng(40.713081, -74.006287), zoom: 15, mapTypeId: google.maps.MapTypeId.ROADMAP }; map = new google.maps.Map(a, b); google.maps.event.addListenerOnce(map, "idle", function () { placeMarkerByAvailableMethod(); createMapSearchBox() }); google.maps.event.addListener(map, "click", function (a) { repositionMarker(a.latLng.lat(), a.latLng.lng()) }) } function addMarker(a, b, c, d) { var e = $("#" + mapWrapperId).attr("data-pathtoimages") + "/footer-map-marker-icon.png"; c = new google.maps.Marker({ position: new google.maps.LatLng(a, b), map: map, title: c, icon: e, draggable: d }); markers.push(c); c.setMap(map); map.setCenter(new google.maps.LatLng(a, b)); google.maps.event.addListener(c, "dragend", function (a) { latitudeElement.val(a.latLng.lat()); longitudeElement.val(a.latLng.lng()) }) } function setMarkerByAddress(a) { null != a && 0 < a.length && $.ajax({ cache: !1, type: "GET", url: "http://maps.google.com/maps/api/geocode/json?address=" + a + "&sensor=false", success: function (a) { a && "ZERO_RESULTS" != a.status && 0 < a.results.length && repositionMarker(a.results[0].geometry.location.lat, a.results[0].geometry.location.lng) } }) } function placeMarkerByAvailableMethod() { addMarker("40.713081", "-74.006287", "Placed", !0); var a = "0", b = "0", a = new RegExp(/^-?\d+\.?\d*$/); 0 < latitudeElement.length && 0 < longitudeElement.length && 0 < latitudeElement.val().length && 0 < longitudeElement.val().length && a.test(latitudeElement.val().trim()) && a.test(longitudeElement.val().trim()) ? (a = latitudeElement.val().trim(), b = longitudeElement.val().trim(), repositionMarker(a, b)) : navigator.geolocation ? navigator.geolocation.getCurrentPosition(function (a) { repositionMarker(a.coords.latitude, a.coords.longitude) }) : (a = $("#customer-nop-address"), 0 < a.length && 0 < a.val().length && (a = a.val(), setMarkerByAddress(a))) } function repositionMarker(a, b) { markers[0].setPosition(new google.maps.LatLng(a, b)); map.setCenter(new google.maps.LatLng(a, b)); latitudeElement.val(markers[0].position.lat()); longitudeElement.val(markers[0].position.lng()) } function moveMarkerOnCoordinatesChange() { var a = latitudeElement.val(), b = longitudeElement.val(), c = new RegExp(/^-?\d+\.?\d*$/); 0 < a.length && 0 < b.length && c.test(a) && c.test(b) && (markers[0].setPosition(new google.maps.LatLng(a, b)), map.setCenter(new google.maps.LatLng(a, b))) } function setAllMap(a) { for (var b = 0; b < markers.length; b++) markers[b].setMap(a) } function clearMarkers() { setAllMap(null) } function showMarkers() { setAllMap(map) } function deleteMarkers() { clearMarkers(); markers = [] } function createMapSearchBox() { $("#shop-address-input").on("keyup keypress", function (a) { if (13 == a.which) return a.preventDefault(), !1 }); var a = document.getElementById("shop-address-input"); map.controls[google.maps.ControlPosition.TOP_LEFT].push(a); var b = new google.maps.places.SearchBox(a); a.style.display = "block"; google.maps.event.addListener(b, "places_changed", function () { var a = b.getPlaces(); 0 != a.length && (repositionMarker(a[0].geometry.location.lat(), a[0].geometry.location.lng()), map.setCenter(a[0].geometry.location)) }) };
