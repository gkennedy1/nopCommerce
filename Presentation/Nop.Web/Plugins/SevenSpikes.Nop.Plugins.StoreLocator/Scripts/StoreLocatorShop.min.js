/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

function loadMapScript() { var e = document.createElement("script"); e.src = "https://maps.googleapis.com/maps/api/js?sensor=false&sensor=false&callback=initializeMap", document.body.appendChild(e) } function initializeMap() { var e = document.getElementById(mapWrapperId), a = { center: new google.maps.LatLng(shopX, shopY), zoom: 15, mapTypeId: google.maps.MapTypeId.ROADMAP }; map = new google.maps.Map(e, a), google.maps.event.addListenerOnce(map, "idle", onMapLoad) } function onMapLoad() { var e = { lat: shopX, lng: shopY }; addMarker(e, shopElement.siblings("h1").text(), !1), directionsService = new google.maps.DirectionsService, directionsDisplay = new google.maps.DirectionsRenderer, directionsDisplay.setPanel(document.getElementById("directions-panel")) } function addMarker(e, a, o) { var t = new google.maps.Marker({ position: new google.maps.LatLng(e.lat, e.lng), map: map, title: a, draggable: o }); return markers.push(t), t.setMap(map), map.setCenter(new google.maps.LatLng(e.lat, e.lng)), markers.length - 1 } function setAllMap(e) { for (var a = 0; a < markers.length; a++) markers[a].setMap(e) } function clearMarkers() { setAllMap(null) } function showMarkers() { setAllMap(map) } function deleteMarkers() { clearMarkers(), markers = [] } function getUserGeoLocation() { var e = "Geolocation is not supported by this browser."; return navigator.geolocation && navigator.geolocation.getCurrentPosition(function (a) { e = "Now we use your current position. ( Maybe a confirmation is required by the browser to use it. )"; var o = new google.maps.LatLng(a.coords.latitude, a.coords.longitude); createUserMarker(o), userMarker.setPosition(o), map.setCenter(o), showDirectionsToShop() }), e } function createUserMarker(e) { if (!isUserMarkerCreated) { var a = $(".shop-resources").attr("data-pathtoimages") + "/squat_marker_green_thumb.png", o = new google.maps.Marker({ position: e, map: map, icon: a, animation: google.maps.Animation.DROP, title: $(".shop-resources").attr("data-youarehere"), draggable: !0 }); o.setMap(map), userMarker = o, isUserMarkerCreated = !0, google.maps.event.addListener(o, "dragend", function () { showDirectionsToShop() }) } } function showDirectionsToShop() { if (isUserMarkerCreated && null != markers[0]) { var e = "Imperial" == $(".shop-resources").attr("data-units"), a = { origin: new google.maps.LatLng(userMarker.position.lat(), userMarker.position.lng()), destination: new google.maps.LatLng(markers[0].position.lat(), markers[0].position.lng()), travelMode: google.maps.TravelMode.DRIVING, unitSystem: e ? google.maps.UnitSystem.IMPERIAL : google.maps.UnitSystem.METRIC }; directionsService.route(a, function (e, a) { a == google.maps.DirectionsStatus.OK && (directionsDisplay.setMap(map), directionsDisplay.setDirections(e)), $("#directions-panel").addClass("directions-shown") }) } } var mapWrapperId = "shop-map-holder", shopCoordinatesElementClass = ".shop-coordinates", shopElement, directionsService, directionsDisplay, map, markers = [], userMarker, isUserMarkerCreated = !1, shopX = 0, shopY = 0; $(document).ready(function () { $(shopCoordinatesElementClass).length > 0 && null != document.getElementById(mapWrapperId) && (shopElement = $(shopCoordinatesElementClass), shopX = shopElement.attr("data-latitude"), shopY = shopElement.attr("data-longitude"), loadMapScript(), $(".shop-map-images .main-picture-link, .all-shop-images > li > a").magnificPopup({ type: "image", removalDelay: 300, gallery: { enabled: !0 } }), $(".get-directions-to-shop").one("click", function (e) { e.preventDefault(), getUserGeoLocation() })) });
